
# 002. Realms

## 1. Contexto

O IS4 não tem suporte a múltiplos realms, ou múltiplos locatários (tenants).

O modelo utilizado pelo KeyCloak é um bom exemplo de como implementar realms, 
onde cada realm é um conjunto de usuários, clientes, escopos, etc.

## 2. Decisão

Será adicionado suporte a Realms no RoyalIdentity.

O Realm será identificado pelo path, como um valor de rota.
Por exemplo, o padrão do endpoint de token no IS4 é `/connect/token`,
utilizando realm será `myrealm/connect/token`. 

Os padrões de rotas devem ser: `{realm}/{protocol}/{operation}` e `{realm}/{area}/{action}`.
Por exemplo `{realm}/connect/token`, `{realm}/account/login`.

Um Middleware será responsável por identificar o Realm e carregar as configurações específicas.

Alguns dados serão isolados por Realm, como:
- Clientes;
- Chaves;
- Escopos e Recursos;
- Usuários e Sessões.

Muitas configurações poderão ser feitas por Realm, como:
- Discovery, Endpoints, MTLS;
- Keys;
- Cache;
- Account.

## 3. Consequências

As rotas deverão identificar o Realm, e os endpoints deverão ser registrados com o Realm.

O acesso a dados dependerá do Realm atual da requisição.

Opções serão configuráveis por realm, o que impactará as opções do server e constantes.